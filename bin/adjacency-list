#!/usr/bin/env awk -f

# meta file is set with awk -v meta=file

BEGIN {
  FS = "\t"
  OFS = "\t"
}

/./ {
  source = $1
  sink = $2
  weight = $3

  if(previous_sink == sink) {
    print(source, weight)
  } else {
    previous_sink = sink
    print(sink)
    print(source, weight)
  }

  # metadata
  edges += 1
  max_source = source > max_source ? source : max_source
}

END {
  printf("%d %d %d\n\n", edges, max_source, sink) >meta
}

